---
title: Zendesk Live Agent Handoff
slug: /apps/chat/live-agent-handoff/zendesk
---

## Zendesk Configuration

Maven Chat integrates with Zendesk Conversations to provide human support capabilities. This integration requires configuration in both Zendesk and Maven.

#### Requirements

- Zendesk account with Professional plan or above
- Access to the Conversations API
- Admin access to configure integrations

#### Setup Process

Follow these steps to configure Zendesk integration:

<Steps>
  <Step title="Configure Maven Context Field">
    - Go to **Objects and Rules > Tickets > Fields**
    - Click **Add fields**
    - Select `Multi-line`
    - Set Name to `Maven Context`
    - Click **Save**
    - After saving, note the **Field Id**.
  </Step>
  <Step title="Create Zendesk Integration">
   - Navigate to the **Zendesk Admin Center**
   - Go to **Apps and integrations > Integrations > Conversations integrations**
   - Click **Create integration**
   - Enter a unique name for the integration
  </Step>
  <Step title="Configure first Conversations webhook">
    - Set **Webhook endpoint URL** to `https://chat.onmaven.app/api/zendesk/webhook`
    - Uncheck **Webhook body data**
    - Check all **Webhook subscriptions**
    - Click **Save**
    - After saving, note the **AppID** along with the **Webhook ID** and **Shared Secret** which are displayed on the page below the **Integration ID** field.
  </Step>
  <Step title="Generate API Key">
    - On the same screen after conversation webhook creation, navigate to the **API Keys** tab
    - Click **Create API key**
    - Enter an identifying name for the key
    - Copy and securely store the provided **Key ID** and **Secret key**
    - Click **Next** to complete the setup
  </Step>
  <Step title="Configure second Zendesk webhook">    
    - Go to **Apps and integrations > Webhooks > Webhooks**
    - Click **Create webhook** (top right) > Select **Trigger or automation** > Click **Next**
    - Add Details. Set 
      - **Name** to `Maven Chat Webhook`
      - **Description** to `Webhook to receive messaging notifications directly from zendesk`
      - **Endpoint URL** to `https://chat.onmaven.app/api/zendesk/webhook`
      - **Request method** to `POST`
      - **Request format** to `JSON`
      - **Authentication** to `None`
    - Click **Create webhook**
    - Click **Finish setup**
    - Go to **Objects and rules > Business Rules > Triggers**
    - Click **Create Trigger**
    - Fill Form. Set
      - **Trigger name** to `[Chat] Messaging`
      - **Trigger category** to `Notifications`
    - Set Conditions
      - **Meet ALL of the following conditions**
        - Category: `Ticket > Messaging session ended reason`
        - Operator: `Changed to`
        - Value: `Ended by agent`
    - Set Actions
        - Category: `Notify by > Active webhook`
        - Value: `Maven Chat Webhook`
      - Payload:
```json
 {
  "webhook": {
    "id": "<REPLACE_WITH_WebhookID_FROM_STEP_3>" // REPLACE!!!
  },
  "type": "zendesk:trigger",
  "events": [
    {
      "id": "zendesk_trigger_conversation_ended",
      "type": "conversation:ended",
      "payload": {
        "ticket": {
          "mavenContext": "{{ticket.ticket_field_<REPLACE_WITH_Field Id>}}", // REPLACE!!!
          "id": "{{ticket.id}}",
          "title": "{{ticket.title}}",
          "description": "{{ticket.description}}",
          "url": "{{ticket.url}}",
          "link": "{{ticket.link}}",
          "external_id": "{{ticket.external_id}}",
          "via": "{{ticket.via}}",
          "custom_status": "{{ticket.custom_status}}",
          "status_category": "{{ticket.status_category}}",
          "status": "{{ticket.status}}",
          "priority": "{{ticket.priority}}",
          "ticket_type": "{{ticket.ticket_type}}",
          "due_date": "{{ticket.due_date}}",
          "current_holiday_name": "{{ticket.current_holiday_name}}",
          "latest_comment_html": "{{ticket.latest_comment_html}}",
          "latest_public_comment_html": "{{ticket.latest_public_comment_html}}",
          "account": "{{ticket.account}}",
          "cc_names": "{{ticket.cc_names}}",
          "tags": "{{ticket.tags}}",
          "brand": {
            "name": "{{ticket.brand.name}}"
          },
          "group": {
            "name": "{{ticket.group.name}}"
          },
          "requester": {
            "first_name": "{{ticket.requester.first_name}}",
            "last_name": "{{ticket.requester.last_name}}",
            "name": "{{ticket.requester.name}}",
            "email": "{{ticket.requester.email}}",
            "language": "{{ticket.requester.language}}",
            "phone": "{{ticket.requester.phone}}",
            "external_id": "{{ticket.requester.external_id}}",
            "details": "{{ticket.requester.details}}",
            "field": "{{ticket.requester_field}}"
          },
          "assignee": {
            "first_name": "{{ticket.assignee.first_name}}",
            "last_name": "{{ticket.assignee.last_name}}",
            "name": "{{ticket.assignee.name}}",
            "email": "{{ticket.assignee.email}}"
          },
          "organization": {
            "name": "{{ticket.organization.name}}",
            "external_id": "{{ticket.organization.external_id}}",
            "details": "{{ticket.organization.details}}",
            "notes": "{{ticket.organization.notes}}"
          }
        },
        "current_user": {
          "first_name": "{{current_user.first_name}}",
          "name": "{{current_user.name}}",
          "email": "{{current_user.email}}",
          "external_id": "{{current_user.external_id}}",
          "phone": "{{current_user.phone}}",
          "details": "{{current_user.details}}",
          "notes": "{{current_user.notes}}",
          "language": "{{current_user.language}}",
          "organization": {
            "name": "{{current_user.organization.name}}",
            "notes": "{{current_user.organization.notes}}",
            "details": "{{current_user.organization.details}}"
          }
        },
        "satisfaction": {
          "current_comment": "{{satisfaction.current_comment}}",
          "current_rating": "{{satisfaction.current_rating}}"
        }
      }
    }
  ]
}
```

    - Click **Create trigger**
  </Step>
  <Step title="Enable Ending Sessions">
  1. In Admin Center, click **Channels > Messaging and Social > Messaging**
  2. Click **Manage settings**
  3. Under Advanced, click **Ending sessions**
  4. Select **Agents can end messaging sessions at any time**
  5. Click **Save settings**
  </Step>
</Steps>

#### Configuration

Create a handoff configuration object with the following structure:

1. Create your configuration object:

```json
{
  "type": "zendesk",
  "subdomain": "your-zendesk-subdomain",
  "appId": "your_zendesk_app_id",
  "webhookId": "your-webhook-id",
  "webhookSecret": "your-webhook-secret",
  "apiKey": "int_your_integration_api_key",
  "apiSecret": "your_integration_api_secret",
  "mavenContextFieldId": "your-field-id",
  "shouldForceUserAuthentication": true,
  "forceUserAuthenticationApiEmail": "your api email",
  "forceUserAuthenticationApiToken": "your api token",
  "setEmailAsExternalId": true,
  "enableAvailabilityCheck": true,
  "availabilityCheckApiEmail": "your api email",
  "availabilityCheckApiToken": "your api token",
  "passControlOptions": [
    {
      "option": "origin_source_type",
      "value": "web"
    }
  ]
}
```

2. To correctly set the email address on the Zendesk contact or to enable an agent availability check, generate an API token.
    - Go to **Apps and integrations > APIs > API Tokens**
    - Click **Add API token** (top right), give it a description, click **Save**
    - Copy and securely store the generated token

**Note:** 
    - By default, the Zendesk `external_id` is set to the user's `id` on `signedUserData`.
    - If your Zendesk `external_id` needs to be different, set the property `externalId` to the new value on the `signedUserData` property of the chat configuration.
    - To use the contact email as the user ID, set `setEmailAsExternalId` to `true`. Note that this option is only available for unsigned user data.
    - Implementing handoff with the `passControlOptions` set to `origin_source_type: web` will allow the handoff conversations to come through as `via messaging`.
    - If configuring both setting the email address on the Zendesk contact and enabling an agent availability check, you will need 2 API tokens.

3. Convert to JSON and add to Maven:
   - Convert the object to a JSON string
   - Enter it in the **Live agent handoff configuration** field in chat app settings

##### Configuration Options

| Option | Type | Required | Default | Description |
| --------------------- | --------- | -------- | ------- | ------------------------------------------------------------- |
| `type` | `zendesk` | Yes | - | Identifies Zendesk as the handoff provider |
| `subdomain` | string | Yes | - | Your Zendesk subdomain |
| `appId` | string | Yes | - | Your Zendesk conversation integration app ID (step 3) |
| `webhookId` | string | Yes | - | Your Zendesk conversation integration webhook ID (step 3) |
| `webhookSecret` | string | Yes | - | Your Zendesk conversation integration webhook secret (step 3) |
| `apiKey` | string | Yes | - | Your Zendesk conversation integration API key (step 4) |
| `apiSecret` | string | Yes | - | Your Zendesk conversation integration secret (step 4) |
| `mavenContextFieldId` | string    | Yes      | -       | Your Zendesk field ID (found in fields list after creation)   |
| `shouldForceUserAuthentication` | boolean    | No      | -       | Whether to force user authentication when creating users via the API   |
| `forceUserAuthenticationApiEmail` | string    | No      | -       | The email address of the API token creator    |
| `forceUserAuthenticationApiToken` | string    | No      | -       | A generated API token from configuration step 2    |
| `setEmailAsExternalId` | boolean    | No      | -       | If set to `true`, uses the user's email as their Zendesk external_id (only works for unsigned users) |
| `enableAvailabilityCheck` | boolean    | No      | -       | Whether to do an agent availability check at the beginning of the maven conversation creation   |
| `availabilityCheckApiEmail` | string    | No      | -       | The email address of the API token creator    |
| `availabilityCheckApiToken` | string    | No      | -       | A generated API token from configuration step 2   |
| `passControlOptions` | array    | No      | -       | If object `origin_source_type` is set to `web`, conversations will come through as `via messaging` in Zendesk |
